# Встроенное приложение "Дашборды"
Встроенное приложение для построения оперативной отчетности

## Release Notes

### 2.4.0

*  Доработан виджет таблица. Теперь доступно построение  таблицы без группировки по параметру. Доступен также расчет процентного соотношения к указанному пользователем набору данных.
*  Добавлен функционал ограничения доступных атрибутов фильтрации источника, используя механизм меток с определенным кодом.
*  Реализован механизм локализации дашбордов. 
*  Добавлена возможность сворачивать верхнюю горизонтальную панель для оптимального использования места и увеличения области просмотра.
*  При использовании навигации виджет, на который происходит переход, подсвечивается серым цветом
*  На диаграммах теперь доступно использование одновременно процента и абсолютного значения.
*  Исправлены ошибки: функции ТОП для целого числа и агрегации SUM; исправлен вывод динамических атрибутов в статусе неактивный; ошибки в работе подсказки для спидометра, ошибки в работе раскраски параметра и устранена излишняя валидация на комбо-диаграмме.

### 2.3
* Изменена логика работы “кебаба” (меню на виджете).
* Добавлен функционал всплывающей подсказки.
* Разработаны юнит тесты в рамках реализации автоматического тестирования.
* Изменено ограничению по выводимым данным, в случае когда используется разбивка.
* Добавлена возможность использования одинаковых ссылочных атрибутов в параметре и разбивке в случаях когда используется разная агрегация или несколько показателей (для виджета таблица).

#### Исправление ошибок
* исправлена выгрузка дашборда в формат pdf
* исправлено построение виджета при использовании ссылочных атрибутов
* исправлена работа функции навигации (при существовании большого числа объектов одного типа - ссылка вела на первый попавшийся)
* исправлена ошибка подписи дат на оси
* исправлено использование группировки дата(часы) на комбо диаграмме
* исправлена ошибка подгрузки атрибутов, при наличии в классе арибута связанного объекта (когда этот объект элемент справочника)

### 2.2
* Доработан тип виджета Спидометр: Добавлена возможность для границ указывать атрибуты, использовать формулы. Реализована возможность отображать “легенду” с описанием диапазонов, добавлена возможность настройки стиля для подписей. Доработано отображение самого виджета: увеличена длина стрелки.
* Добавлен функционал отображения итогового числа элементов.
* Для Мобильного клиента скрыты элементы управления с виджета
* Доработан функционал навигации - в случае когда на странице выведено несколько контентов с ВП откорректировано поведение.
* Изменен цвет меток по умолчанию на черный, тень отключена
* Внесены изменения в ошибки отдаваемые пользователю при работе с приложением. Они стали более детализированными.
* Функционал настройки формата меток добавлен для круговых виджетов, а также настройка параметров показателя добавлена для типов виджета сводка и спидометр
* Добавлена возможность переноса правой панели в левую\правую часть экрана.
* Исправлены ошибки: построения виджета когда атрибут атрибута задан на уровне типа. Ошибка авто обновления диаграмм после обновления страницы. Некорректное поведение настроек заголовка и ручной настройки цветов. Исправлено некорректное отображение осей для комбо диаграммы

### 2.1.1
* Скорректировано поведение критериев фильтрации  Содержит (включая архивные)/Не содержит (включая архивные) в пользовательской группировке;
* Устранен сброс в панели редактирования настроенных цветов параметра;
* В режиме мобильного клиента скрыты элементы управления  на виджете;
* Исправлено дефектное поведение вычислимого показателя в виджете-спидометре;
* Восстановлена работа функции автообновления после обновления страницы;
* Возвращена возможность размещения заголовка внизу виджета;
* Скорректировано отображение осей на комбо-диаграмме;
* Исправлено отображение разбивки в таблице

### 2.1.0
* Реализована возможность по настройке формата отображения меток и параметра;
* Добавлены новые критерии фильтрации (для атрибутов с типом дата/время) для пользовательских группировок;
* Доработана функция навигации, в случае когда на странице выведено несколько контентов с ВП Дашборды;
* Исправлены ошибки при вводе константы в вычислимом поле.

### 2.0.0
* Добавлена возможность создавать виджет и текст по клику правой кнопки мыши
* При большом количестве меток - происходит их отключение для предотвращения снижения производительности. Добавлено информационное сообщение для пользователя.
* Исправлены ошибки отображения подписей к оси (налезание, частичное скрытие и пр.)
* Добавлена возможность сохранения источников с установленной фильтрацией для вторичного использования при построении виджетов.
* Заблокирована возможность использования одного атрибута в параметре и показателе.
* Исправлены ошибки в работе ВП с модулем проверки прав.
* Возможность построения виджетов по служебному классу (история изменения запроса и статуса)
* Исправлены ошибки при изменении формата для атрибута Временной интервал
* Для виджета таблица реализована возможность использовать дополнительные источники для вычислений
* Добавлена возможность работы с динамическими атрибутами любого типа
* Реализована настройка фильтрации на виджете в режиме просмотра

### 1.0.11
* технический релиз, исправление багов и мелкие доработки

### 1.0.10
* Переход дрилл-даун в список объектов с виджета-сводки теперь возможен по клику на само число;
* В таблице добавлена сортировка по столбцу параметра и автоподбор ширины столбца с номерами строк;
* Внесены правки для корректного отображения дашборда при экспорте;
* Исправлена ошибка сортировки при активном чек-боксе ТОП;
* Доработан переход дашборда в полноэкранный режим для версий платформы от 4.12;
* Изменена архитектура модулей и механизм перемещения виджетов по дашборду;
* Для типа виджета спидометр расширен функционал интервалов: добавлена возможность указывать дробные , отрицательные числа.

### 1.0.9
* Переработана вкладка стиль: для виджета таблица добавлены новые возможности настройки стиля - отдельно настройка шрифта для заголовка таблицы и тела таблицы;
* Также на вкладке стиль теперь доступна настройка осей для комбо диаграммы: добавлена возможность именования для любой оси, гибкая настройка сортировки посредством добавления функции выбора источника;
* Реализована навигация на дашбордах - добавлена возможность настройки перехода с виджета на другой виджет;
* Реализована новая функция вывода TOP значений показателя для всех видов диаграмм;
* Отправка дашборда на e-mail теперь доступна на любой адрес (ранее только на адреса сотрудников, зафиксированных в системе);
* Для виджета типа таблица убрано ограничение выводимых значений (ранее было ограничение в 100 строк), добавлены “заглушки” препятствующие подписанию виджета  в случае большого количество строк или столбцов;
* Реализована валидация количества источников в зависимости от типа виджета;
* Реализовано отображение нулевых значений на комбо диаграмме, а также в легенде;
* Исправлены ошибки вкладки стиль, отображения подписей (добавлен перенос подписей и наклон при необходимости), исправлено поведение при выводе вычисляемого атрибута ( в случае непредвиденного деления на 0), ошибки при построении виджета на основе справочников и относительных критериев фильтрации, а также ошибка отсутствия ограничения на кол-во виджетов на дашборде при добавлении их копированием;
* Исправлена ошибка экспорта таблицы в XLS (с разбивкой выгружались не все данные).

### 1.0.8
* теперь на дашборд можно добавить не только диаграмму, но и текст, настроив его стиль по своему усмотрению;
* появилась возможность вывести нулевые столбцы при использовании кастомной группировки;
* оптимизированы интерфейс и возможности настройки комбо-диаграммы и таблицы (можно настроить шкалы для каждой из осей, установить количество строк на одной странице таблицы и т.д);
* при построении виджета по типу учитываются не только его объекты, но и объекты вложенных подтипов;
* исключена возможность построения виджетов оп атрибутам типа счётчик;
* реализован дрилл-даун с ячейки таблицы с агрегацией N/A ссылочного атрибута на карточку объекта;
* усовершенствованы настройки стиля для виджетов типа сводка и спидометр;
* добавлена подгонка высота айфрейма под высоту контента для избавления от двойных скроллов.

### 1.0.7
* пользователи из группы с кодом dashboardMaster стали учитываться как Мастера дашбордов (подготовка к созданию системной группы пользователей dashboardMaster)
* реализована возможность отправки файла с дашбордом на e-mail любого сотрудника
* добавлен функционал учета/неучета данных с незаполненными атрибутами (null)
* откорректировано построение виджета, в котором в качестве источника выбран тип с вложенными подтипами
* в интерфейсе просмотра дашборда устранены отступы слева и справа от границы контента до виджетов, теперь правая панель редактирования появляется поверх дашборда
* исправлено отображение виджетов и переключение режима для Личного дашборда
* заменена иконка для виджета-спидометра
* исправлена ошибка с подгрузкой только системных статусов при создании пользовательской группировки
* добавлена возможность вывести заголовок в нижней части виджета
* реализован вывод легенды в строку для ее расположения в верхней и нижней частях виджета
* теперь по умолчанию легенда выводится только на тех виджетах, где установлена разбивка
* изменена иконка фильтра на правой панели для более наглядного отображения того, применена фильтрация к источнику или нет
* размер показателя в сводке по умолчанию уменьшен до 60

### 1.0.6
* Появилась возможность построения виджета по некоторым типам динамических атрибутов (строки, даты, временной * интервал)
* Модернизирован виджет-таблица: теперь можно использовать для построения таблицы несколько источников, в качестве параметра выбрать несколько атрибутов и выбрать для каждого из них группировку, вывести неагрегированные данные,*  перейти на список объектов drill-down с каждой ячейки
* Добавлена агрегация “Среднее значение” для нечисловых атрибутов типа элемент справочника, ссылка на БО, обратная * ссылка, набор ссылок на БО, набор элементов справочника
* Реализовано применение пользовательских группировок одновременно в параметре и разбивке показателя
* Работает drill-down для новых типов группировок по датам
* Переименованы пакеты в модулях для избежания конфликтов имен с методами в других модулях
* Изменен интерфейс панели управления на виджете
* На комбо-диаграмме выведены оси для каждого из показателей
* Реализована возможность использования переменных в заголовках виджетов
* Заменены методы для возможности лицензирования ВП Дашборды
* Появилась возможность копирования виджетов для суперпользователей и мастера даш

### 1.0.5
* Добавлены новые типы форматирования по датам (без дриллдауна)
* Добавлена агрегация для атрибута временной интервал
* Реализован новый тип виджета "Спидометр"
* Изменены поля наименования виджета, добавлен функционал уникальности названий
* Исправлен bug: не отображалась кастомная группировка в разбивке
* Добавлена всплывающая подсказка в панели настройки кастомных группировок
* В виджете типа таблица при установленной агрегации %- исправлено отображение значений.
* Не сохраняется вычислимое поле, если оно заканчивается математическим действием
* Добавлена возможность использования дробных констант в вычислимом поле
* Добавлено значение по умолчанию - уникальный идентификатор в параметре показатель
* Переработано модальное окно в части дизайна.
* Исправлены ошибки при построении виджета(кастомная группировка с разбивкой), ошибка загрузка данных при использовании в настройках атрибута "Уникальный идентификатор" в параметре показатель,  при использовании в настройках формулы в вычислимом поле и разбивки

### 1.0.4
* добавлена возможность построения диаграмм по атрибутам типа Счётчик и Обратный счётчик, а также по Логическому атрибуту и атрибуту типа Метакласс;
* ограничен размер возвращаемого датасета для построения диаграмм (100 строками);
* исправлен некорректный переход на список объектов с виджета, построенного с использованием кастомной группировки;
* реализована возможность использования атрибута связанного объекта при построении  диаграмм;
* осуществлен переход на работу с новым ApiCriteria (это значит, что эта и последующие версии ВП Дашборды будут работать на тех версиях, в которые входит задача по новому ApiCriteria);
* переработана вкладка "Стиль" на панели создания/редактирования виджета (в т.ч. расширены возможности пользовательской настройки стилей);
* реализована корректная работа функции "Разбивка" в диаграммах, построенных с использованием вычислений;

### 1.0.3
* добавлена возможность настройки пользователем собственных группировок для всех типов атрибутов (например, теперь пользователь может вывести на диаграмму группы по статусам запросов “открыт”, “закрыт” и “прочие”, настроив группу самостоятельно все, что должно попасть в группу “прочие”);
* добавлено явное разделение вида дашборда на “общий” (т.е. системный, настроенный Мастером дашбордов для всех) и “мой” (т.е. личный, тот, на который любой пользователь может вносить изменения и дополнения);
* доработан тип форматирования “7 дней” для атрибута типа дата (дата/время) для применения в вычислимом поле;
* появился экспорт виджета-таблицы в формат .xlsx;
* реализовано сохранение настроенной пользователем ширины столбцов для виджета-таблицы;
* добавлены всплывающие подсказки с названиями типов виджетов;
* доработана возможность выбора в качестве атрибута ссылочного атрибута ссылки (набора ссылок) на бизнес-объект, метакласса, элемента (набора элементов) справочника, обратной ссылки и статуса

### 1.0.2
* во все типы виджетов добавлена возможность использования вычислений  (ранее она была доступна только в комбинированной диаграмме);
* созданные в виджете вычисления теперь можно отредактировать;
* для поддержания производительности на должном уровне максимально возможное количество виджетов на одном дашборде ограничено 30-ю;
* реализована функциональность задания пользователем интервала времен автоматического обновления информации во всех виджетах дашборда;
* при переходе с виджета на список объектов (дрилл-даун) появилась проверка на наличие указанного для этого типа объектов шаблона списка, что позволяет для каждого метакласса открыть список в соответствии с его шаблоном

### 1.0.1
* построение диаграммы на основе adv-листа;
* возможность задания атрибута ссылочного атрибута для вывода на оси;
* багофикс;
* прочие мелкие улучшения.

### 1.0.0
Реализовано создание графических отчетов (виджетов) на основе объектной модели SMP.
Доступные для создания типы виджетов:
* столбчатая диаграмма;
* параметризованная столбчата диаграмма;
* гистограмма;
* параметризованная гистограмма;
* круговая диаграмма (бублик и пирог);
* линейный график;
* комбинированная диаграмма;
* таблица;
* сводка.

Для комбинированной диаграммы реализована возможность создания и использования для построения диаграммы вычислимых полей.
Доступен экспорт дашбордов в следующие форматы:
* PNG
* PDF

Также есть возможность отправки экспортированного дашборда на почту.

## Требования

1. `node.js` версии `6` или выше
1. `npm` версии `4.5` или выше

## Установка, настройка и сборка

### Установка

```bash
$ npm i
```

Эта команда устанавливает все необходимые пакеты для разработки и сборки встраиваемого приложения.

### Настройка

Необходимо отредактировать файлы `readme.md` и `package.json`, которые находятся в корневой папке разрабатываемого приложения:

- в `readme.md` поместить описание создаваемого приложения, особенности его сборки, настройки и использования;
- в `package.json` нужно отредактировать поля `author`, `bugs`, `description`, `homepage`, `keywords`, `name` и `version` так, чтобы они содержали актуальные значения.

### Сборка для разработки

1. Измените файл .env.develop в соответсвии с настройками:

* API_DRIVER=exec-dev - параметр драйвера для работы с REST API
* EDITABLE_MODE=edit:Редактируемый - режим запуска ВП
* USER_LANG=ru - язык пользователя
* API_URL - URL портала для ВП
* ACCESS_KEY - API ключ для ВП
* CONTENT_CODE - код виджета - jsApi.findContentCode()
* CONTEXT_OBJECT_META_CLASS - код класса на котором размещен виджет - (await jsApi.commands.getCurrentContextObject()).metaClass
* SUBJECT_UUID - ключ класса на котором размещен виджет - jsApi.extractSubjectUuid()
* USER_LOGIN - логин пользователя - jsApi.getCurrentUser().login
* USER_UUID - UUID пользователя - jsApi.getCurrentUser().uuid


2. Выполните

```bash
$ npm run dev
```

Сценарий `dev` собирает модули в итоговую сборку и держит ее в памяти. Результат можно увидеть в браузере по адресу `http://ваш-ip-адрес:8080`. При изменении каких либо исходных файлов (кроме конфигурационных), запустится процесс пересборки и после его окончания страница в браузере обновится.

### Сборка для эксплуатации

1. Измените файл .env.build в соответсвии с настройками:
* API_DRIVER=exec - параметр драйвера для работы через exec/exec-post

```bash
$ npm run build
```

Сценарий `build` перед началом сборки выполняет очистку папки `dist` в корне проекта от файлов предыдущей сборки, создает файлы новой сборки в папке `dist`, а после окончания сборки создает архив `dist-DD-MM-YYYY HH-mm-SS.zip` из файлов в папке `dist`, где `DD-MM-YYYY` - дата в формате `день-месяц-год`, а `HH-mm-SS` - время в формате `часы-минуты-секунды`.

## Прочие сценарии

Помимо сценариев `dev` и `build` существуют еще сценарии `flow`, `lint`, `test` и `test:watch`.

`build-no-module`, сценарий подобный сценирию `build`, но собирает сборку без groovy-модулей. Нужно для обновление стендов с открытыми модулями

`build-dev`, сценарий подобный сценирию `build`, но собирает сборку без groovy-модулей и без применения минификаторов и оптимизаторов. Нужен для отладки

`build-stats` запускает сборку статистики по сценарию `build`. Использует `BundleStatsWebpackPlugin`

`flow` запускает статическую проверку типов. `lint` проверяет код на соответствие стилю написания кода. `test` запускает тесты, а `test:watch` запускает тесты в режиме наблюдения: при изменении файлов тесты будут перезапускаться.

## Разработка встраиваемого приложения

При разработке приложения код следует располагать в папке `src`, а в папке `tests` - тесты.

## Тестирование

При написании тестов `flow` может работать некорректно. Чтобы это исправить, необходимо выполнить команду:

```bash
$ flow-typed install jest@версия-jest-указанная-в-package.json
```

## Совместимость

Система сборки (`webpack@4`) и утилита преобразования `ES6` (`babel`) в `JavaScript` не подразумевают работу результата в `Internet Explorer 8`.
