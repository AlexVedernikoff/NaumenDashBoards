# Локализация

Локализация представлена функцией translate данного пакета

Формат функции translate:

```
translate(key, params)
```

где, ```key``` - строка ключей из файлов локализации, а ```params``` - словарь
подстановки в случае локализации, или параметры функции плюрализации.

## Формат файлов локализации

Формат файлов локализации: json. Где ключ - параметр ```key``` функции
локализации ```translate```. А значение может быть 2х видов: строка или объект.

Если значение строка, то функция ```translate``` возвращает эту строку с заменой
параметров указанных в параметре ```params```.

Если значение объект, то функция ```translate``` вызывает ранее установленный
метод экземпляра класса ```IPluralization```, указанный в значении
```[func]``` этого объекта. Первым параметром в него передастся значение
```[data]``` этого объекта, а вторым пар метром значение второго параметра
функции ```translate```.

### Генератор локализации

Для облегчения перевода на различные языки была сделана утилита
```generate-localalize```

Это утилита разбирает excel-файл  ```src/localization/json/localization.xlsx```
где в первой строке перечислены языки перевода, в первом столбце - ключ перевода,
а на пересечении строки и столбца - перевод ключа на этот язык

В случае плюрализации в ячейку вставляется JSON объекта (см. ниже)

Вызывать утилиту можно через ```npm``` командой
```npm run generate-localalize```

### Подстановка в строке локализации

В случае, если в значении локализации будет строка, то в этой стоке
последовательно будут заменены все вхождения ключей из объекта второго параметра
функции ```translate```, обернутые в фигурные скобки, на их значения.

Например, следующий вызов функции:

```
translate('FUNC::KEY', {'name': 'test', value: 123})
```

при значении ```FUNC::KEY``` в файле локализации

```
...
  "FUNC::KEY" : "Тестовая строка {name} - {value}",
...
```

вернет
```'Тестовая строка test - 123'```

При этом строка будет подставлена полностью без изменений, число приведено
к локальному значению, описному в методе ```number``` файла плюрализации, дата
приведена к локальной строке, через метод ```date``` файла плюрализации. Все
остальные объекты будут приведены к строке согласно правилам javascript

### Плюрализация

В случае, если в значении локализации будет объект, то из этого объекта
выбираются 2 значения ```func``` и ```data```

В объекте, реализующим интерфейс ```IPluralization``` в каталоге ```pluralization```
возьмется метод с названием ```func``` и вызовется с параметрами ```data``` и
```params``` переданного в функцию ```translate```

Например, следующий вызов функции:

```
translate('FUNC::KEY', {'name': 'test', value: 123})
```

при значении ```FUNC::KEY``` в файле локализации

```
...
  "FUNC::KEY" : {
	  "func": "oddValue",
	  "data" {
		  0: "Тестовая строка 1 - {name}",
		  1: "Тестовая строка 2 - {value}",
	  }
...
```

и метода плюрализации ```oddValue```:

```
	oddValue(data, params) {
		const {value} = params;
		return data[value % 2];
	}
```

вернет
```'Тестовая строка 2 - 123'```

## Соглашение по ключам

Формат ключа для локализации ```[PREFIX]::[KEY]```, где

```[PREFIX]``` - логический компонент системы, в случаях если локализация
используется внутри визуальных компонентов. Для Redux store ```[PREFIX]```
формируется как ```store::[STORE_PATH]```, где ```STORE_PATH``` путь в redux-store,
разделенный двумя двоеточиями.

А ```[KEY]``` - уникальный для этого компонента идентификатор в PascalCase регистре

Примеры:

```Select::SelectMessage``` - компонент ```Select```, уникальный код ```SelectMessage```

```store::dashboard::settings::CreatePersonalDashboardError``` - сообщение ошибки
используемого в redux-actions по пути ```dashboard.settings```.

## Утилитарные компоненты

Для облегчения использования компонентов в React добавлены 2 компонента:

### HOC withTranslation ( ```src/components/templates/TranslationProvider/withTranslation``` )

При обертывании компонента в указанный HOC в компонент добавляется 2 параметра:

```locale``` - значение текущей выставленной локали, ```t``` - функция-транслятор,
обертка над ```translate```. Функция автоматически изменится на новую при смене
параметра ```locate```


### Компонент Translation ( ```src/components/atoms/Translation``` )

Компонент, который заменяет свое значение, переданное внутри компонента, на строку
вернувшеюся из функции ```translate```. При этом все свои свойства (за исключением
свойств children, t) и имеющим тип строка, число или дата, передаст вторым
параметром функции.

Например, следующий рендер

```
	import T from 'components/atoms/Translation';
	...
	renderErrorText = () => {
		const value = 'Плохое значение';
		return (
			<T value={value}>Component::Error</T>
		)
	}
	...
```

при значении ключа ```Component::Error``` в файле локализации

```
	"Component::Error": "Ошибка отображения значения \"{value}\"", ....
```

отобразит ```Ошибка отображения значения "Плохое значение"```


